---
classes:
  - role::monitoring_server

firewalld::ports:
  'Prometheus':
    ensure: present
    zone: public
    port: 9090
    protocol: 'tcp'
  'AlertManager':
    ensure: present
    zone: public
    port: 9093
    protocol: 'tcp'
  'Grafana':
    ensure: present
    zone: public
    port: 3000
    protocol: 'tcp'

prometheus::manage_prometheus_server: true

prometheus::version: '2.15.2'

prometheus::alerts:
  groups:
    - name: 'alert.rules'
      rules:
        - alert: 'InstanceDown'
          expr: 'up == 0'
          for: '5m'
          labels:
            severity: 'page'
          annotations:
            summary: 'Instance {{ $labels.instance }} down'
            description: '{{ $labels.instance }} of job {{ $labels.job }} has been
              down for more than 5 minutes.'

prometheus::scrape_configs:
  - job_name: 'prometheus'
    scrape_interval: '10s'
    scrape_timeout: '10s'
    static_configs:
      - targets:
          - 'localhost:9090'
        labels:
          alias: 'Prometheus'
  - job_name: 'node'
    scrape_interval: '10s'
    scrape_timeout: '10s'
    static_configs:
      - targets:
          - 'jenkins-dev:9100'
          - 'jenkins:9100'
        labels:
          alias: 'Node'

prometheus::alertmanagers_config:
  - static_configs:
      - targets:
          - 'localhost:9093'

